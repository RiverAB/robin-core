// Tab Indent
var tabIndent={version:"0.1.8",config:{tab:"    "},events:{keydown:function(e){var t=tabIndent.config.tab,n=t.length;if(9===e.keyCode){e.preventDefault();var s=this.selectionStart,i=this.selectionEnd;if(e.shiftKey===!1)if(tabIndent.isMultiLine(this)){for(var a=tabIndent.findStartIndices(this),l=a.length,r=void 0,d=void 0,u=0;l--;){var v=a[l];a[l+1]&&s!=a[l+1]&&(v=a[l+1]),v>=s&&a[l]<i&&(this.value=this.value.slice(0,a[l])+t+this.value.slice(a[l]),r=a[l],d||(d=a[l+1]?a[l+1]-1:"end"),u++)}this.selectionStart=r,this.selectionEnd="end"!==d?d+n*u:this.value.length}else this.value=this.value.slice(0,s)+t+this.value.slice(s),this.selectionStart=s+n,this.selectionEnd=i+n;else if(tabIndent.isMultiLine(this)){for(var a=tabIndent.findStartIndices(this),l=a.length,r=void 0,d=void 0,u=0;l--;){var v=a[l];a[l+1]&&s!=a[l+1]&&(v=a[l+1]),v>=s&&a[l]<i&&(this.value.substr(a[l],n)==t&&(this.value=this.value.slice(0,a[l])+this.value.slice(a[l]+n),u++),r=a[l],d||(d=a[l+1]?a[l+1]-1:"end"))}this.selectionStart=r,this.selectionEnd="end"!==d?d-u*n:this.value.length}else this.value.substr(s-n,n)==t?(this.value=this.value.substr(0,s-n)+this.value.substr(s),this.selectionStart=s-n,this.selectionEnd=i-n):"\n"==this.value.substr(s-1,1)&&this.value.substr(s,n)==t&&(this.value=this.value.substring(0,s)+this.value.substr(s+n),this.selectionStart=s,this.selectionEnd=i-n)}else if(27===e.keyCode)tabIndent.events.disable(e);else if(13===e.keyCode&&e.shiftKey===!1){var h=tabIndent,o=this.selectionStart,a=h.findStartIndices(this),c=a.length,f=0,b=0,g=new RegExp("^"+t.replace(" ","\\t").replace(/ /g,"\\s")+"+","g"),E="";tabs=null;for(var m=0;c>m;m++){if(a[m+1]&&o>=a[m]&&o<a[m+1]){f=a[m],b=a[m+1]-1;break}f=a[c-1],b=this.value.length}if(E=this.value.slice(f,b),tabs=E.match(g),null!==tabs){e.preventDefault();var I=tabs[0],p=I.length,y=o-f;p>y&&(p=y,I=I.slice(0,y)),this.value=this.value.slice(0,o)+"\n"+I+this.value.slice(o),this.selectionStart=o+p+1,this.selectionEnd=this.selectionStart}}},disable:function(e){tabIndent.remove(e.target)},focus:function(){var e=tabIndent,t=this,n=setTimeout(function(){var n=(t.getAttribute("class")||"").split(" "),s=n.indexOf("tabIndent");t.addEventListener("keydown",e.events.keydown),-1!==s&&n.splice(s,1),n.push("tabIndent-rendered"),t.setAttribute("class",n.join(" ")),t.removeEventListener("focus",e.events.keydown)},500);t.addEventListener("blur",function s(){clearTimeout(n),t.removeEventListener("blur",s)})}},render:function(e){var t=this;"TEXTAREA"===e.nodeName&&(e.addEventListener("focus",t.events.focus),e.addEventListener("blur",function(e){t.events.disable(e)}))},renderAll:function(){for(var e=document.getElementsByTagName("textarea"),t=e.length,n=-1,s=[],i=void 0;t--;)s=(e[t].getAttribute("class")||"").split(" "),n=s.indexOf("tabIndent"),-1!==n&&(i=e[t],this.render(i)),n=-1,s=[],i=void 0},remove:function(e){if("TEXTAREA"===e.nodeName){var t=(e.getAttribute("class")||"").split(" "),n=t.indexOf("tabIndent-rendered");-1!==n&&(e.removeEventListener("keydown",this.events.keydown),e.style.backgroundImage="",t.splice(n,1),t.push("tabIndent"),e.setAttribute("class",t.length>1?t.join(" "):t[0]))}},removeAll:function(){for(var e=document.getElementsByTagName("textarea"),t=e.length,n=-1,s=[],i=void 0;t--;)s=(e[t].getAttribute("class")||"").split(" "),n=s.indexOf("tabIndent-rendered"),-1!==n&&(i=e[t],this.remove(i)),n=-1,s=[],i=void 0},isMultiLine:function(e){var t=e.value.slice(e.selectionStart,e.selectionEnd),n=new RegExp(/\n/);return n.test(t)?!0:!1},findStartIndices:function(e){for(var t=e.value,n=[],s=0;t.match(/\n/)&&t.match(/\n/).length>0;){s=n.length>0?n[n.length-1]:0;var i=t.search("\n");n.push(i+s+1),t=t.substring(i+1)}return n.unshift(0),n}};
